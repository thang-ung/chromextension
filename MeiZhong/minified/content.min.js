"use strict";let dl={};async function enableTab(){let success;if(await dedupmei.send({type:"register",op:0})){if(!dl.stenp){(dl={stenp:new Zhad,chatbox:new zhoChat}).port=chrome.runtime.connect(),dl.port?dl.port.onDisconnect.addListener(()=>{disableTab().remove()}):console.log("portfail"),dl.stenp.onOpen(),dl.stenp.onNavigate(),window.addEventListener("beforeunload",()=>{dedupmei.send({type:"register"})});let cfgObserve={attributeFilter:["class"],attributeOldValue:!0},observer;new MutationObserver(muti=>{let muta;for(let muta of muti){let state=muta.target.classList.contains("hidden")?1:0,hid=muta.oldValue.split(" ").filter(x=>"hidden"==x).join("")?1:0;hid^state&&(dedupmei.send({type:"state",state:hid}),muta.target.classList.toggle("paused"))}}).observe(Zhad.shadow.getElementById("zhong"),cfgObserve)}}else;}function disableTab(){return dl.stenp.destroy(),delete dl.stenp,delete dl.chatbox,dl.port&&dl.port.disconnect(),delete dl.port,document.getElementById("extension-zhopad")}function onactive(isactive){window.parent!==globalThis||(isactive?enableTab():dl.stenp&&(dedupmei.send({type:"register"}),disableTab()))}chrome.storage.onChanged.addListener(function(changes,namespace){for(var key in changes)switch(key){case"context":dl.stenp instanceof Zhad&&dl.stenp.syncOptions(changes[key]);break;case"active":onactive(changes[key].newValue)}}),chrome.storage.sync.get(["active"],values=>{onactive(!(!chrome.runtime.lastError&&!values.active))});