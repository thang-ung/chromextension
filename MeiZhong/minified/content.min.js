"use strict";let dl={};async function enableTab(props){let success;if(await dedupmei.send({type:"register",op:0})){if(!dl.stenp){(dl={stenp:new Zhad(props),chatbox:new zhoChat,state:props}).port=chrome.runtime.connect(),dl.port?dl.port.onDisconnect.addListener(()=>{disableTab()}):console.log("portfail"),dl.stenp.onOpen(),dl.stenp.onNavigate(),window.addEventListener("beforeunload",()=>{dedupmei.send({type:"register"})});let cfgObserve={attributeFilter:["class"],attributeOldValue:!0},observer;new MutationObserver(muti=>{let muta;for(let muta of muti){let state=muta.target.classList.contains("hidden")?1:0,hid=muta.oldValue.split(" ").filter(x=>"hidden"==x).join("")?1:0;hid^state&&(dedupmei.send({type:"state",state:hid}),muta.target.classList.toggle("paused"))}}).observe(Zhad.root.getElementById("zhong"),cfgObserve)}}else;}function disableTab(){return dedupmei.send({type:"register"}),dl.stenp.destroy(),delete dl.stenp,delete dl.chatbox,dl.port&&dl.port.disconnect(),delete dl.port,document.getElementById("extension-zhopad")}function onactive(isactive,props){window.parent!==globalThis||(isactive?enableTab(props):dl.stenp&&(dedupmei.send({type:"register"}),disableTab()))}function bootup(active){chrome.storage.sync.get(["active","context"],values=>{onactive(!(!chrome.runtime.lastError&&!values.active),values.context)})}chrome.storage.onChanged.addListener(function(changes,namespace){for(var key in changes)switch(key){case"context":if(dl.stenp instanceof Zhad){let actuals;propxor(changes[key].oldValue,changes[key].newValue).shadowIsolate?(disableTab(),enableTab(changes[key].newValue)):dl.stenp.syncOptions(changes[key])}break;case"active":bootup(changes[key].newValue)}}),bootup();